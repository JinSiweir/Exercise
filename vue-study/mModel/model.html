<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>响应式数据</title>
  </head>
  <body>
    <script>
      //   数据响应式
      function defineReactive(obj, key, val) {
        //   递归进行对象中对象属性响应式
        observe(val);
        //设置响应式
        Object.defineProperty(obj, key, {
          get() {
            console.log(`get`, key);
            return val;
          },
          set(newVal) {
            if (newVal != val) {
              console.log(`set`, key);
              observe(newVal);
              val = newVal;
            }
          },
        });
      }
      function observe(obj) {
        if (typeof obj !== "object" || obj === null) {
          return;
        }
        //  遍历对象属性设置响应式
        Object.keys(obj).forEach((key) => {
          defineReactive(obj, key, obj[key]);
        });
      }
      function set(obj, key, val) {
        defineReactive(obj, key, val);
      }
      const obj = {
        foo: "foo",
        bar: "bar",
        baz: {
          z: 1,
        },
      };
      observe(obj);
      obj.foo;
      obj.foo = "22222";
      obj.bar;
      obj.bar = `sada`;
      obj.baz.z;
    </script>
  </body>
</html>
